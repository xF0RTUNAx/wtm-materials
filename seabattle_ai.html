<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xFORTUNAx | Sea Battle</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #0f0f12;
            --grid-color: #1a1a20;
            --border-color: #2c2c35;
            --highlight: #00e5ff;
            
            --color-lun: #ff3838;
            --color-battle: #7f8fa6;
            --color-missile: #2ed573;
            
            --hit: #ff4757;
            --miss: #dfe4ea;
            --radar: #9b59b6; 
            --barrage: #ff9f43; /* –¶–≤–µ—Ç –∑–∞–ª–ø–∞ */
            --detected: #f1c40f; 

            --msg-success-bg: #d1e7dd;
            --msg-success-border: #a3cfbb;
            --msg-success-text: #0f5132;
            --msg-error-bg: #f8d7da;
            --msg-error-border: #f1aeb5;
            --msg-error-text: #842029;
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            overflow-x: hidden;
        }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .top-nav {
            width: 100%; max-width: 1200px; display: flex; justify-content: flex-start; margin-bottom: 10px;
        }
        .btn-back-home {
            background: rgba(255, 255, 255, 0.1); color: #ccc; text-decoration: none;
            padding: 8px 15px; border-radius: 8px; font-size: 0.9rem; display: flex; align-items: center;
            gap: 8px; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1);
        }
        .btn-back-home:hover { background: rgba(255, 255, 255, 0.2); color: white; }

        h1 { 
            margin: 5px 0 15px 0; text-align: center; text-transform: uppercase; 
            letter-spacing: 1px; font-size: 1.5rem; text-shadow: 0 0 15px rgba(0, 229, 255, 0.3); 
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px;
            width: 100%; max-width: 800px; text-align: left; margin-bottom: 15px;
            font-size: 0.85rem; line-height: 1.4; color: #ccc; border-left: 3px solid var(--highlight);
        }
        .info-panel strong { color: var(--highlight); }

        .status-bar {
            font-size: 1.1rem; font-weight: bold; color: var(--highlight);
            margin-bottom: 10px; height: 25px; text-align: center;
        }

        .game-wrapper {
            display: flex; flex-direction: column; align-items: center; gap: 20px;
            width: 100%; max-width: 1000px;
        }

        .boards-container {
            display: flex; flex-direction: row; gap: 20px; flex-wrap: wrap; justify-content: center; width: 100%;
        }

        .grid-section { display: flex; flex-direction: column; align-items: center; }
        .grid-title { margin-bottom: 8px; font-weight: 600; color: #aaa; font-size: 0.9rem; }

        .grid {
            display: grid; grid-template-columns: repeat(10, 32px); grid-template-rows: repeat(10, 32px);
            gap: 1px; background-color: var(--border-color); border: 3px solid var(--border-color);
            border-radius: 4px; position: relative;
        }

        .cell {
            width: 32px; height: 32px; background-color: var(--grid-color); cursor: crosshair;
            position: relative; transition: background 0.2s;
        }
        .grid.special-mode .cell { cursor: cell; } 

        .cell:hover::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.1); pointer-events: none;
        }
        .cell.hover-valid { background-color: rgba(0, 229, 255, 0.3); }
        .cell.hover-invalid { background-color: rgba(255, 68, 68, 0.3); }
        
        .cell.radar-preview {
            background-color: rgba(155, 89, 182, 0.5) !important;
            box-shadow: 0 0 5px var(--radar); z-index: 5;
        }
        .cell.barrage-preview {
            background-color: rgba(255, 159, 67, 0.5) !important;
            box-shadow: 0 0 5px var(--barrage); z-index: 5;
        }

        .player-cell.occupied { border: 1px solid rgba(0,0,0,0.5); }
        /* –¶–≤–µ—Ç–∞ –∫–æ—Ä–∞–±–ª–µ–π –Ω–∞ –ø–æ–ª–µ –∏–≥—Ä–æ–∫–∞ */
        .player-cell.occupied.lun { background-color: #fab1a0; }
        .player-cell.occupied.battleship { background-color: #b2bec3; }
        .player-cell.occupied.missile { background-color: #55efc4; }

        .ship-grid-label {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 16px; color: #fff; text-shadow: 0 0 4px #000;
            z-index: 2; pointer-events: none;
        }

        .cell.miss::after {
            content: '‚Ä¢'; font-size: 20px; color: var(--miss); position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -55%); line-height: 0;
        }
        
        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ø–∞–¥–∞–Ω–∏—è */
        .cell.hit { background-color: rgba(255, 71, 87, 0.2); }
        .cell.hit::after {
            content: '‚úï'; font-size: 18px; color: var(--hit); position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%); line-height: 0; font-weight: bold;
        }
        .player-cell.occupied.hit {
            background-color: #2d0000 !important; border-color: #ff0000 !important;
        }
        .player-cell.occupied.hit::after {
            content: 'üî•'; font-size: 22px; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            line-height: 0; z-index: 5; filter: drop-shadow(0 0 5px orange);
            animation: burn 1s infinite alternate;
        }
        
        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —É–Ω–∏—á—Ç–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–æ—Ä–∞–±–ª—è (Sunk) */
        .cell.sunk {
            background-color: #2f3542 !important;
            border: 2px solid #ff4757 !important;
            opacity: 0.8;
        }
        .cell.sunk::after {
            content: 'üíÄ'; font-size: 18px; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            line-height: 0; z-index: 6; animation: none;
        }

        @keyframes burn { from { transform: translate(-50%, -50%) scale(1); } to { transform: translate(-50%, -50%) scale(1.2); } }

        .cell.detected { background-color: rgba(241, 196, 15, 0.2); border: 1px solid var(--detected); }
        .cell.detected::after {
            content: 'üëÅÔ∏è'; font-size: 16px; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%); line-height: 0;
        }

        .dock {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px;
            width: 100%; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .ship-container {
            display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 6px 12px;
            background: rgba(0,0,0,0.3); border-radius: 8px; cursor: grab;
            border: 2px solid transparent; transition: all 0.3s; position: relative;
        }
        .ship-container:active { cursor: grabbing; }
        .ship-container.placed { opacity: 0.5; filter: grayscale(1); cursor: default; }
        .ship-container.selected { border-color: var(--highlight); background: rgba(0, 229, 255, 0.1); }

        .ship-visual { display: flex; align-items: center; justify-content: center; padding: 5px; }
        .ship-img { width: 100%; height: auto; max-height: 40px; object-fit: contain; filter: drop-shadow(2px 4px 4px rgba(0,0,0,0.8)); }
        
        .ship-info { display: flex; flex-direction: column; justify-content: center; text-align: center; }
        .ship-name { font-weight: 700; font-size: 0.85rem; color: #eee; line-height: 1.2; }
        .ship-size { font-size: 0.7rem; color: #aaa; margin-top: 2px; display: block; }

        .controls { display: flex; gap: 10px; justify-content: center; margin-top: 10px; flex-wrap: wrap; width: 100%; }
        .btn {
            padding: 10px 20px; background: var(--highlight); color: #0f0f12; border: none; border-radius: 50px;
            font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;
        }
        .btn:hover { box-shadow: 0 0 15px var(--highlight); transform: translateY(-2px); }
        .btn:disabled { background: #555; color: #888; cursor: not-allowed; box-shadow: none; transform: none; }
        
        .btn-start { background: linear-gradient(45deg, #2ed573, #26de81); color: white; display: none; }
        
        .btn-radar { background: linear-gradient(45deg, #8e44ad, #9b59b6); color: white; }
        .btn-radar.active { box-shadow: 0 0 15px #9b59b6; border: 2px solid white; }

        .btn-barrage { background: linear-gradient(45deg, #ff9f43, #ee5253); color: white; }
        .btn-barrage.active { box-shadow: 0 0 15px #ee5253; border: 2px solid white; }

        #enemy-area { display: none; }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 5000;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }

        .result-card {
            width: 100%; max-width: 450px; border-radius: 12px; padding: 20px;
            display: flex; flex-direction: column; gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); animation: slideIn 0.4s ease-out;
        }
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .result-card.win { background-color: var(--msg-success-bg); border-left: 8px solid var(--msg-success-text); color: var(--msg-success-text); }
        .result-card.lose { background-color: var(--msg-error-bg); border-left: 8px solid var(--msg-error-text); color: var(--msg-error-text); }

        .result-header { font-size: 1.3rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .result-body { font-size: 0.95rem; line-height: 1.5; }
        .result-actions { display: flex; justify-content: flex-end; margin-top: 10px; }
        .btn-restart {
            padding: 8px 16px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer;
            background: rgba(0,0,0,0.1); color: inherit; transition: 0.2s;
        }
        .btn-restart:hover { background: rgba(0,0,0,0.2); }
        .reward-link { color: #0056b3; font-weight: bold; text-decoration: underline; }
        
        .reward-img { width: 100%; max-width: 200px; border-radius: 8px; margin: 10px auto; display: block; border: 2px solid #0f5132; }

        @media (max-width: 768px) {
            h1 { font-size: 1.2rem; }
            .info-panel { font-size: 0.75rem; padding: 10px; }
            .boards-container { gap: 15px; }
            .grid { 
                grid-template-columns: repeat(10, 8vw); grid-template-rows: repeat(10, 8vw); 
                max-width: 350px; max-height: 350px;
            }
            .cell { width: 8vw; height: 8vw; max-width: 35px; max-height: 35px; }
            .ship-visual img { max-height: 30px; }
            .dock { padding: 10px; }
            .ship-container { padding: 5px 10px; }
            .ship-name { font-size: 0.75rem; }
            .ship-size { font-size: 0.65rem; }
            .btn { font-size: 0.75rem; padding: 10px 15px; }
        }
    </style>
</head>
<body>

    <nav class="top-nav">
        <a href="findagame.html" class="btn-back-home">
            <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –∏–≥—Ä—ã
        </a>
    </nav>

    <h1>–ú–æ—Ä—Å–∫–æ–π –±–æ–π</h1>
    
    <div class="info-panel">
        <div style="text-align:center; margin-bottom:10px;"><strong>–ü—Ä–∞–≤–∏–ª–∞ –±–æ—è</strong></div>
        1. –†–∞—Å—Å—Ç–∞–≤—å—Ç–µ —Ñ–ª–æ—Ç. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–æ—Ä–∞–±–ª—è–º–∏ ‚Äî –º–∏–Ω–∏–º—É–º 1 –∫–ª–µ—Ç–∫–∞.<br>
        2. <strong>–°–µ–∑–æ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (1 —Ä–∞–∑ –∑–∞ –±–æ–π):</strong><br>
        ‚Ä¢ <i class="fas fa-satellite-dish" style="color:var(--radar)"></i> <strong>–†–∞–¥–∞—Ä (–õ—É–Ω—å):</strong> –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ–±–ª–∞—Å—Ç—å 2x2. <span style="color:#ff4444">–ï—Å–ª–∏ –õ—É–Ω—å —É–Ω–∏—á—Ç–æ–∂–µ–Ω ‚Äî –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.</span><br>
        ‚Ä¢ <i class="fas fa-bomb" style="color:var(--barrage)"></i> <strong>–ó–∞–ª–ø (–õ–∏–Ω–∫–æ—Ä):</strong> –ù–∞–Ω–æ—Å–∏—Ç —É–¥–∞—Ä –ø–æ –æ–±–ª–∞—Å—Ç–∏ 2x2. <span style="color:#ff4444">–ï—Å–ª–∏ –õ–∏–Ω–∫–æ—Ä —É–Ω–∏—á—Ç–æ–∂–µ–Ω ‚Äî –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.</span>
    </div>

    <div class="status-bar" id="status-bar">–§–∞–∑–∞: —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–æ—Ç–∞</div>

    <div class="game-wrapper">
        <div class="boards-container">
            <div class="grid-section">
                <div class="grid-title">–í–ê–® –§–õ–û–¢</div>
                <div class="grid" id="player-grid"></div>
            </div>

            <div class="grid-section" id="enemy-area">
                <div class="grid-title">–†–ê–î–ê–† –¶–ï–õ–ò (–ò–ò)</div>
                <div class="grid" id="enemy-grid"></div>
            </div>
        </div>

        <div class="controls" id="setup-controls">
            <button class="btn" onclick="rotateAxis()">–ü–æ–≤–æ—Ä–æ—Ç: <span id="axis-display">–ì–æ—Ä–∏–∑–æ–Ω—Ç.</span></button>
            <button class="btn btn-start" id="btn-start-game" onclick="startGame()">–í –ë–û–ô</button>
            <button class="btn" style="background:#ff4444; color:white" onclick="location.reload()">–°–±—Ä–æ—Å</button>
        </div>

        <div class="controls" id="battle-controls" style="display: none;">
            <button class="btn btn-radar" id="btn-radar" onclick="toggleRadar()">
                <i class="fas fa-satellite-dish"></i> –†–∞–¥–∞—Ä (–õ—É–Ω—å)
            </button>
            <button class="btn btn-barrage" id="btn-barrage" onclick="toggleBarrage()">
                <i class="fas fa-bomb"></i> –ó–∞–ª–ø (–õ–∏–Ω–∫–æ—Ä)
            </button>
            <button class="btn" style="background:#ff4444; color:white" onclick="location.reload()">–°–¥–∞—Ç—å—Å—è</button>
        </div>

        <div class="dock" id="dock">
            <div class="ship-container ship-lun" id="p-lun" draggable="true" data-size="1" data-type="lun">
                <div class="ship-visual" style="width: 50px;">
                    <img src="https://github.com/xF0RTUNAx/wtm-materials/blob/pics/lun.PNG?raw=true" class="ship-img" alt="Lun">
                </div>
                <div class="ship-info">
                    <span class="ship-name">–õ—É–Ω—å</span>
                    <span class="ship-size">–†–∞–∑–º–µ—Ä: 1</span>
                </div>
            </div>

            <div class="ship-container ship-battleship" id="p-bs" draggable="true" data-size="4" data-type="battleship">
                <div class="ship-visual" style="width: 140px;">
                    <img src="https://github.com/xF0RTUNAx/wtm-materials/blob/pics/USS%20Tennessee.PNG?raw=true" class="ship-img" alt="USS Tennessee">
                </div>
                <div class="ship-info">
                    <span class="ship-name">USS Tennessee</span>
                    <span class="ship-size">–†–∞–∑–º–µ—Ä: 4</span>
                </div>
            </div>

            <div class="ship-container ship-missile" id="p-ms1" draggable="true" data-size="2" data-type="missile">
                <div class="ship-visual" style="width: 80px;">
                    <img src="https://github.com/xF0RTUNAx/wtm-materials/blob/pics/Pr.%2011352.PNG?raw=true" class="ship-img" alt="Pr. 11352">
                </div>
                <div class="ship-info">
                    <span class="ship-name">–ü—Ä. 11352</span>
                    <span class="ship-size">–†–∞–∑–º–µ—Ä: 2</span>
                </div>
            </div>

            <div class="ship-container ship-missile" id="p-ms2" draggable="true" data-size="3" data-type="missile">
                <div class="ship-visual" style="width: 110px;">
                    <img src="https://github.com/xF0RTUNAx/wtm-materials/blob/pics/HMS%20Type%2045.PNG?raw=true" class="ship-img" alt="HMS Type 45">
                </div>
                <div class="ship-info">
                    <span class="ship-name">HMS Type 45</span>
                    <span class="ship-size">–†–∞–∑–º–µ—Ä: 3</span>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="result-overlay">
        <div class="result-card" id="result-card-content"></div>
    </div>

    <script>
        const gridSize = 10;
        let isHorizontal = true;
        let gameState = 0; // 0=Setup, 2=PlayerTurn, 3=AiTurn
        
        let playerBoard = Array(100).fill(null);
        let enemyBoard = Array(100).fill(null);
        let enemyBoardVis = Array(100).fill(null);

        const pGrid = document.getElementById('player-grid');
        const eGrid = document.getElementById('enemy-grid');
        const statusEl = document.getElementById('status-bar');
        const btnStart = document.getElementById('btn-start-game');
        
        const btnRadar = document.getElementById('btn-radar');
        const btnBarrage = document.getElementById('btn-barrage');
        
        let draggedShip = null; 
        let selectedShip = null;
        let placedShipsCount = 0;
        const totalShips = 4;

        // –î–∞–Ω–Ω—ã–µ —Ñ–ª–æ—Ç–∞ –∏–≥—Ä–æ–∫–∞
        const fleet = {
            'p-lun': { size: 1, type: 'lun', hits: 0, cells: [] },
            'p-bs':  { size: 4, type: 'battleship', hits: 0, cells: [] },
            'p-ms1': { size: 2, type: 'missile', hits: 0, cells: [] },
            'p-ms2': { size: 3, type: 'missile', hits: 0, cells: [] }
        };

        // –î–∞–Ω–Ω—ã–µ —Ñ–ª–æ—Ç–∞ –ò–ò (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è)
        let enemyFleet = [];
        let aiStack = []; 
        
        // –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        let radarUsed = false;
        let isRadarMode = false;
        
        let barrageUsed = false;
        let isBarrageMode = false;

        function initGrids() {
            createGrid(pGrid, 'player');
            createGrid(eGrid, 'enemy');
            setupDragAndClick();
        }

        function createGrid(gridEl, owner) {
            gridEl.innerHTML = '';
            for (let i = 0; i < 100; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                if (owner === 'player') cell.classList.add('player-cell');
                cell.dataset.index = i;
                
                if (owner === 'player') {
                    // Desktop events
                    cell.addEventListener('dragover', dragOver);
                    cell.addEventListener('dragleave', dragLeave);
                    cell.addEventListener('drop', dropShip);
                    cell.addEventListener('click', () => playerGridClick(i));
                    // Mobile events
                    cell.addEventListener('touchstart', touchStartCell, {passive: false});
                    cell.addEventListener('touchmove', touchMoveCell, {passive: false});
                    cell.addEventListener('touchend', touchEndCell);
                } else {
                    cell.addEventListener('click', () => enemyGridClick(i));
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –¥–ª—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
                    cell.addEventListener('mouseenter', () => handleAbilityHover(i, true));
                    cell.addEventListener('mouseleave', () => handleAbilityHover(i, false));
                }
                gridEl.appendChild(cell);
            }
        }

        function setupDragAndClick() {
            document.querySelectorAll('.ship-container').forEach(ship => {
                ship.addEventListener('dragstart', (e) => {
                    if (ship.classList.contains('placed')) { e.preventDefault(); return; }
                    draggedShip = ship;
                });
                ship.addEventListener('click', (e) => {
                    if (gameState === 0 && !ship.classList.contains('placed')) {
                        if (selectedShip) selectedShip.classList.remove('selected');
                        ship.classList.add('selected');
                        selectedShip = ship;
                    }
                });
                ship.addEventListener('touchstart', (e) => {
                    if (ship.classList.contains('placed')) { e.preventDefault(); return; }
                    draggedShip = ship;
                    ship.style.opacity = '0.7'; 
                }, {passive: false});
                ship.addEventListener('touchend', (e) => {
                    ship.style.opacity = '1';
                    if (draggedShip) {
                        if (gameState === 0 && !ship.classList.contains('placed')) {
                            if (selectedShip) selectedShip.classList.remove('selected');
                            ship.classList.add('selected');
                            selectedShip = ship;
                        }
                        draggedShip = null;
                    }
                });
            });
        }

        // --- –õ–û–ì–ò–ö–ê –†–ê–ó–ú–ï–©–ï–ù–ò–Ø –ò–ì–†–û–ö–ê ---
        let lastTouchedCell = null;

        function touchStartCell(e) {
            e.preventDefault(); 
            const touch = e.touches[0];
            const cell = document.elementFromPoint(touch.clientX, touch.clientY);
            if (cell && cell.classList.contains('cell')) {
                lastTouchedCell = cell;
                const index = parseInt(cell.dataset.index);
                if (selectedShip && gameState === 0) playerGridClick(index);
                else if (draggedShip) highlight(index, parseInt(draggedShip.dataset.size), true);
            }
        }
        function touchMoveCell(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const cell = document.elementFromPoint(touch.clientX, touch.clientY);
            if (cell && cell.classList.contains('cell') && cell !== lastTouchedCell) {
                if (lastTouchedCell && draggedShip) highlight(parseInt(lastTouchedCell.dataset.index), parseInt(draggedShip.dataset.size), false);
                lastTouchedCell = cell;
                if (draggedShip) highlight(parseInt(cell.dataset.index), parseInt(draggedShip.dataset.size), true);
            }
        }
        function touchEndCell(e) {
            e.preventDefault();
             if (lastTouchedCell && draggedShip) {
                highlight(parseInt(lastTouchedCell.dataset.index), parseInt(draggedShip.dataset.size), false);
                placeShipLogic(parseInt(lastTouchedCell.dataset.index), draggedShip);
            }
            draggedShip = null;
            lastTouchedCell = null;
        }
        function dragOver(e) {
            e.preventDefault();
            const ship = draggedShip || selectedShip;
            if (!ship) return;
            highlight(parseInt(this.dataset.index), parseInt(ship.dataset.size), true);
        }
        function dragLeave(e) {
            const ship = draggedShip || selectedShip;
            if (!ship) return;
            highlight(parseInt(this.dataset.index), parseInt(ship.dataset.size), false);
        }
        function dropShip(e) {
            e.preventDefault();
            if (!draggedShip) return;
            placeShipLogic(parseInt(this.dataset.index), draggedShip);
            draggedShip = null;
        }
        function playerGridClick(index) {
            if (gameState === 0 && selectedShip) {
                if (placeShipLogic(index, selectedShip)) {
                    selectedShip.classList.remove('selected');
                    selectedShip = null;
                }
            }
        }

        function placeShipLogic(index, shipEl) {
            const size = parseInt(shipEl.dataset.size);
            const id = shipEl.id;
            const type = shipEl.dataset.type;
            const indices = getIndices(index, size);
            if (!indices) return false; 
            if (!checkPlacementValidity(playerBoard, indices)) return false; 

            indices.forEach(idx => {
                playerBoard[idx] = id;
                const cell = pGrid.children[idx];
                cell.classList.add('occupied', type);
            });

            const midIndex = Math.floor(indices.length / 2);
            const centerCellIdx = indices[midIndex];
            const centerCell = pGrid.children[centerCellIdx];
            if (id === 'p-ms1') centerCell.innerHTML += '<span class="ship-grid-label">1</span>'; 
            if (id === 'p-ms2') centerCell.innerHTML += '<span class="ship-grid-label">2</span>'; 

            fleet[id].cells = indices;

            if (gameState === 0) {
                shipEl.classList.add('placed');
                shipEl.draggable = false;
                placedShipsCount++;
                clearHighlights();
                if (placedShipsCount === totalShips) {
                    statusEl.innerText = "–§–ª–æ—Ç –≥–æ—Ç–æ–≤! –ù–∞–∂–º–∏—Ç–µ '–í –ë–û–ô'.";
                    btnStart.style.display = 'inline-block';
                }
            }
            return true; 
        }

        function checkPlacementValidity(board, indices) {
            for (let idx of indices) {
                if (board[idx] !== null) return false; 
                const neighbors = getNeighbors(idx);
                for (let nIdx of neighbors) {
                    if (board[nIdx] !== null) return false; 
                }
            }
            return true;
        }

        function getNeighbors(idx) {
            const x = idx % 10;
            const y = Math.floor(idx / 10);
            let neighbors = [];
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    if (dx === 0 && dy === 0) continue;
                    const nx = x + dx;
                    const ny = y + dy;
                    if (nx >= 0 && nx < 10 && ny >= 0 && ny < 10) {
                        neighbors.push(ny * 10 + nx);
                    }
                }
            }
            return neighbors;
        }

        function getIndices(start, size) {
            let idxs = [];
            let x = start % 10;
            let y = Math.floor(start / 10);
            for (let i=0; i<size; i++) {
                if (isHorizontal) {
                    if (x + i >= 10) return null;
                    idxs.push(start + i);
                } else {
                    if (y + i >= 10) return null;
                    idxs.push(start + i * 10);
                }
            }
            return idxs;
        }

        function highlight(index, size, on) {
            const idxs = getIndices(index, size);
            if (!idxs) return;
            let valid = checkPlacementValidity(playerBoard, idxs);
            idxs.forEach(i => {
                const c = pGrid.children[i];
                if (on) c.classList.add(valid ? 'hover-valid' : 'hover-invalid');
                else c.classList.remove('hover-valid', 'hover-invalid');
            });
        }
        function clearHighlights() {
            Array.from(pGrid.children).forEach(c => c.classList.remove('hover-valid', 'hover-invalid'));
        }

        function rotateAxis() {
            isHorizontal = !isHorizontal;
            document.getElementById('axis-display').innerText = isHorizontal ? "–ì–æ—Ä–∏–∑–æ–Ω—Ç." : "–í–µ—Ä—Ç–∏–∫.";
        }

        // --- –ë–û–ï–í–û–ô –ü–†–û–¶–ï–°–° ---
        function startGame() {
            setupAI();
            document.getElementById('dock').style.display = 'none';
            document.getElementById('setup-controls').style.display = 'none';
            document.getElementById('battle-controls').style.display = 'flex';
            document.getElementById('enemy-area').style.display = 'flex';
            gameState = 2; // –•–æ–¥ –∏–≥—Ä–æ–∫–∞
            statusEl.innerText = "–ë–û–ô –ù–ê–ß–ê–õ–°–Ø! –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å.";
        }

        function setupAI() {
            enemyFleet = []; 
            const aiShipsSizes = [4, 3, 2, 1]; 
            
            aiShipsSizes.forEach(size => {
                let placed = false;
                while (!placed) {
                    let rnd = Math.floor(Math.random() * 100);
                    let orient = Math.random() > 0.5;
                    let idxs = [];
                    let x = rnd % 10;
                    let y = Math.floor(rnd / 10);
                    let possible = true;
                    
                    for(let k=0; k<size; k++) {
                        let ii = orient ? rnd + k : rnd + k*10;
                        if ((orient && x+k>=10) || (!orient && y+k>=10)) {
                            possible = false; break;
                        }
                        idxs.push(ii);
                    }
                    if (possible) {
                        if (checkPlacementValidity(enemyBoard, idxs)) {
                            idxs.forEach(i => enemyBoard[i] = 'ship');
                            enemyFleet.push({ size: size, hits: 0, cells: idxs, sunk: false });
                            placed = true;
                        }
                    }
                }
            });
        }

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ü–û–°–û–ë–ù–û–°–¢–Ø–ú–ò ---
        
        function getAbilityIndices(start) {
            const x = start % 10;
            const y = Math.floor(start / 10);
            if (x >= 9 || y >= 9) return null;
            return [start, start + 1, start + 10, start + 11]; // 2x2 –∫–≤–∞–¥—Ä–∞—Ç
        }

        function handleAbilityHover(index, on) {
            if (!isRadarMode && !isBarrageMode) return;
            const idxs = getAbilityIndices(index);
            if (!idxs) return;
            
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –†–∞–¥–∞—Ä
            if (isRadarMode) {
                idxs.forEach(i => {
                    const cell = eGrid.children[i];
                    if (on) cell.classList.add('radar-preview');
                    else cell.classList.remove('radar-preview');
                });
            }
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ó–∞–ª–ø
            if (isBarrageMode) {
                idxs.forEach(i => {
                    const cell = eGrid.children[i];
                    if (on) cell.classList.add('barrage-preview');
                    else cell.classList.remove('barrage-preview');
                });
            }
        }

        function clearAbilityModes() {
            isRadarMode = false;
            isBarrageMode = false;
            btnRadar.classList.remove('active');
            btnBarrage.classList.remove('active');
            eGrid.classList.remove('special-mode');
            Array.from(eGrid.children).forEach(c => {
                c.classList.remove('radar-preview', 'barrage-preview');
            });
        }

        // --- –†–ê–î–ê–† ---
        function toggleRadar() {
            if (gameState !== 2 || radarUsed || btnRadar.disabled) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–∑–Ω–∏ –õ—É–Ω—è (p-lun)
            if (fleet['p-lun'].hits >= fleet['p-lun'].size) {
                alert("–õ—É–Ω—å —É–Ω–∏—á—Ç–æ–∂–µ–Ω! –†–∞–¥–∞—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.");
                btnRadar.disabled = true;
                return;
            }

            if (isRadarMode) {
                clearAbilityModes();
                statusEl.innerText = "–†–∞–¥–∞—Ä –æ—Ç–º–µ–Ω–µ–Ω. –í–ê–® –•–û–î.";
            } else {
                clearAbilityModes(); // —Å–±—Ä–æ—Å –¥—Ä—É–≥–∏—Ö —Ä–µ–∂–∏–º–æ–≤
                isRadarMode = true;
                btnRadar.classList.add('active');
                eGrid.classList.add('special-mode');
                statusEl.innerText = "–†–ê–î–ê–†: –í—ã–±–µ—Ä–∏—Ç–µ –∑–æ–Ω—É 2x2.";
            }
        }

        function performRadarScan(index) {
            const idxs = getAbilityIndices(index);
            if (!idxs) return;

            radarUsed = true;
            btnRadar.innerText = "–†–∞–¥–∞—Ä (–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω)";
            btnRadar.disabled = true;
            clearAbilityModes();

            let found = false;
            idxs.forEach(i => {
                const cell = eGrid.children[i];
                if (enemyBoardVis[i] === null) {
                    if (enemyBoard[i] === 'ship') {
                        enemyBoardVis[i] = 'detected';
                        cell.classList.add('detected');
                        found = true;
                    } else {
                        enemyBoardVis[i] = 'miss';
                        cell.classList.add('miss');
                    }
                }
            });

            if (found) statusEl.innerText = "–†–ê–î–ê–†: –¶–µ–ª—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞! –í–ê–® –•–û–î.";
            else statusEl.innerText = "–†–ê–î–ê–†: –ß–∏—Å—Ç–æ. –í–ê–® –•–û–î.";
        }

        // --- –ó–ê–õ–ü –õ–ò–ù–ö–û–†–ê ---
        function toggleBarrage() {
            if (gameState !== 2 || barrageUsed || btnBarrage.disabled) return;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–∑–Ω–∏ –õ–∏–Ω–∫–æ—Ä–∞ (p-bs)
            if (fleet['p-bs'].hits >= fleet['p-bs'].size) {
                alert("–õ–∏–Ω–∫–æ—Ä —É–Ω–∏—á—Ç–æ–∂–µ–Ω! –ó–∞–ª–ø –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.");
                btnBarrage.disabled = true;
                return;
            }

            if (isBarrageMode) {
                clearAbilityModes();
                statusEl.innerText = "–ó–∞–ª–ø –æ—Ç–º–µ–Ω–µ–Ω. –í–ê–® –•–û–î.";
            } else {
                clearAbilityModes(); // —Å–±—Ä–æ—Å –¥—Ä—É–≥–∏—Ö —Ä–µ–∂–∏–º–æ–≤
                isBarrageMode = true;
                btnBarrage.classList.add('active');
                eGrid.classList.add('special-mode');
                statusEl.innerText = "–ó–ê–õ–ü –õ–ò–ù–ö–û–†–ê: –í—ã–±–µ—Ä–∏—Ç–µ –∑–æ–Ω—É 2x2.";
            }
        }

        function performBarrage(index) {
            const idxs = getAbilityIndices(index);
            if (!idxs) return;

            barrageUsed = true;
            btnBarrage.innerText = "–ó–∞–ª–ø (–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω)";
            btnBarrage.disabled = true;
            clearAbilityModes();
            
            statusEl.innerText = "–û–ì–û–ù–¨! –ú–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–¥–∞—Ä...";

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞—Ä–∞ –ø–æ 4 –∫–ª–µ—Ç–∫–∞–º
            let delay = 0;
            idxs.forEach(i => {
                setTimeout(() => {
                    processShot(i);
                }, delay);
                delay += 200; // –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
            });

            // –ü–µ—Ä–µ–¥–∞—á–∞ —Ö–æ–¥–∞ –ò–ò –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                if (gameState === 2) { 
                    statusEl.innerText = "–ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞... –•–æ–¥ –ò–ò.";
                    gameState = 3;
                    setTimeout(aiTurn, 800);
                }
            }, delay + 500);
        }

        function enemyGridClick(index) {
            if (gameState !== 2) return;
            
            if (isRadarMode) {
                performRadarScan(index);
                return;
            }
            if (isBarrageMode) {
                performBarrage(index);
                return;
            }

            // –û–±—ã—á–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª
            if (enemyBoardVis[index] !== null && enemyBoardVis[index] !== 'detected') return;
            
            processShot(index);

            // –ï—Å–ª–∏ –±—ã–ª –ø—Ä–æ–º–∞—Ö, –ø–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥. –ï—Å–ª–∏ –ø–æ–ø–∞–ª - —Å—Ç—Ä–µ–ª—è–µ–º –¥–∞–ª—å—à–µ (–≤ processShot –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è)
            if (enemyBoard[index] !== 'ship') {
                statusEl.innerText = "–ü–†–û–ú–ê–•. –•–æ–¥ –ò–ò...";
                gameState = 3;
                setTimeout(aiTurn, 800);
            }
        }

        // –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã—Å—Ç—Ä–µ–ª–∞ (–∏ –¥–ª—è –∫–ª–∏–∫–∞, –∏ –¥–ª—è –∑–∞–ª–ø–∞)
        function processShot(index) {
            if (enemyBoardVis[index] !== null && enemyBoardVis[index] !== 'detected') return;
            
            const cell = eGrid.children[index];
            
            if (enemyBoard[index] === 'ship') {
                enemyBoardVis[index] = 'hit';
                cell.classList.remove('detected');
                cell.classList.add('hit');
                
                let shipDestroyed = checkEnemyShipDestruction(index);
                
                if (shipDestroyed) statusEl.innerText = "–í–†–ê–ì –ü–û–¢–û–ü–õ–ï–ù! –í–∞—à —Ö–æ–¥.";
                else statusEl.innerText = "–ü–û–ü–ê–î–ê–ù–ò–ï! –í–∞—à —Ö–æ–¥.";
                
                checkWin('player');
            } else {
                enemyBoardVis[index] = 'miss';
                cell.classList.add('miss');
            }
        }

        function checkEnemyShipDestruction(hitIndex) {
            let destroyed = false;
            enemyFleet.forEach(ship => {
                if (ship.sunk) return;
                if (ship.cells.includes(hitIndex)) {
                    ship.hits++;
                    if (ship.hits === ship.size) {
                        ship.sunk = true;
                        destroyed = true;
                        ship.cells.forEach(i => {
                            eGrid.children[i].classList.add('sunk');
                        });
                        markNeighborsAsMiss(ship.cells, eGrid, enemyBoardVis);
                    }
                }
            });
            return destroyed;
        }

        function markNeighborsAsMiss(shipCells, gridEl, visArray) {
            shipCells.forEach(cellIdx => {
                const neighbors = getNeighbors(cellIdx);
                neighbors.forEach(nIdx => {
                    if (visArray[nIdx] === null) {
                        visArray[nIdx] = 'miss';
                        gridEl.children[nIdx].classList.add('miss');
                    }
                });
            });
        }

        function aiTurn() {
            if (gameState !== 3) return;
            let index;
            
            if (aiStack.length === 0) {
                do { index = Math.floor(Math.random() * 100); } 
                while (playerBoard[index] === 'miss' || playerBoard[index] === 'hit');
            } else {
                index = aiStack.pop();
                if (playerBoard[index] === 'miss' || playerBoard[index] === 'hit') {
                    aiTurn(); return;
                }
            }

            const cell = pGrid.children[index];
            const targetId = playerBoard[index];

            if (targetId && targetId !== 'miss' && targetId !== 'hit') {
                playerBoard[index] = 'hit';
                cell.classList.add('hit');
                
                fleet[targetId].hits++;
                
                // –ü–†–û–í–ï–†–ö–ê –ü–û–¢–ï–†–ò –°–ü–û–°–û–ë–ù–û–°–¢–ï–ô
                checkAbilitiesLoss(targetId);

                if (fleet[targetId].hits === fleet[targetId].size) {
                    statusEl.innerText = "–ù–ê–® –ö–û–†–ê–ë–õ–¨ –£–ù–ò–ß–¢–û–ñ–ï–ù!";
                    fleet[targetId].cells.forEach(i => pGrid.children[i].classList.add('sunk'));
                    markNeighborsAsMissPlayer(fleet[targetId].cells);
                    aiStack = [];
                } else {
                    statusEl.innerText = "–ü–û –ù–ê–° –ü–û–ü–ê–õ–ò! –ò–ò –¥–æ–±–∏–≤–∞–µ—Ç.";
                    addNeighborsToStack(index);
                }

                checkWin('ai');
                setTimeout(aiTurn, 1000);
            } else {
                playerBoard[index] = 'miss';
                cell.classList.add('miss');
                statusEl.innerText = "–ò–ò –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è. –í–ê–® –•–û–î.";
                gameState = 2;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ç–µ—Ä–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –ø–æ –∫–æ—Ä–∞–±–ª—é
        function checkAbilitiesLoss(shipId) {
            // –ï—Å–ª–∏ –ø–æ–ø–∞–ª–∏ –ø–æ –õ—É–Ω—é –∏ –æ–Ω —É–Ω–∏—á—Ç–æ–∂–µ–Ω
            if (shipId === 'p-lun' && fleet['p-lun'].hits === fleet['p-lun'].size) {
                if (!radarUsed) {
                    btnRadar.disabled = true;
                    btnRadar.style.background = '#555';
                    alert("–õ—É–Ω—å —É–Ω–∏—á—Ç–æ–∂–µ–Ω! –°–≤—è–∑—å —Å —Ä–∞–¥–∞—Ä–æ–º –ø–æ—Ç–µ—Ä—è–Ω–∞.");
                }
            }
            // –ï—Å–ª–∏ –ø–æ–ø–∞–ª–∏ –ø–æ –õ–∏–Ω–∫–æ—Ä—É –∏ –æ–Ω —É–Ω–∏—á—Ç–æ–∂–µ–Ω
            if (shipId === 'p-bs' && fleet['p-bs'].hits === fleet['p-bs'].size) {
                if (!barrageUsed) {
                    btnBarrage.disabled = true;
                    btnBarrage.style.background = '#555';
                    alert("–õ–∏–Ω–∫–æ—Ä —É–Ω–∏—á—Ç–æ–∂–µ–Ω! –û—Ä—É–¥–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –∫–∞–ª–∏–±—Ä–∞ –º–æ–ª—á–∞—Ç.");
                }
            }
        }

        function markNeighborsAsMissPlayer(shipCells) {
            shipCells.forEach(cellIdx => {
                const neighbors = getNeighbors(cellIdx);
                neighbors.forEach(nIdx => {
                    if (playerBoard[nIdx] !== 'hit' && playerBoard[nIdx] !== 'miss') {
                         playerBoard[nIdx] = 'miss';
                         pGrid.children[nIdx].classList.add('miss');
                    }
                });
            });
        }

        function addNeighborsToStack(idx) {
            const x = idx % 10;
            const y = Math.floor(idx / 10);
            const candidates = [];
            if (y > 0) candidates.push(idx - 10); 
            if (y < 9) candidates.push(idx + 10); 
            if (x > 0) candidates.push(idx - 1);  
            if (x < 9) candidates.push(idx + 1);  
            candidates.sort(() => Math.random() - 0.5);
            candidates.forEach(c => {
                if (playerBoard[c] !== 'miss' && playerBoard[c] !== 'hit') aiStack.push(c);
            });
        }

        function checkWin(who) {
            if (who === 'player') {
                let allSunk = enemyFleet.every(s => s.sunk);
                if (allSunk) showResultModal(true);
            } else {
                let allSunk = Object.values(fleet).every(s => s.hits === s.size);
                if (allSunk) showResultModal(false);
            }
        }

        function showResultModal(isWin) {
            const overlay = document.getElementById('result-overlay');
            const content = document.getElementById('result-card-content');
            overlay.style.display = 'flex';

            if (isWin) {
                const reward = determineReward();
                content.className = 'result-card win';
                content.innerHTML = `
                    <div class="result-header">
                        <i class="fas fa-check-circle"></i> Win - –ü–æ–±–µ–¥–∞!
                    </div>
                    <div class="result-body">
                        –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, –∞–¥–º–∏—Ä–∞–ª! –§–ª–æ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ —É–Ω–∏—á—Ç–æ–∂–µ–Ω.<br>
                        ${reward}
                    </div>
                    <div class="result-actions">
                        <button class="btn-restart" onclick="location.reload()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    </div>
                `;
            } else {
                content.className = 'result-card lose';
                content.innerHTML = `
                    <div class="result-header">
                        <i class="fas fa-times-circle"></i> Defeat - –ü–æ—Ä–∞–∂–µ–Ω–∏–µ
                    </div>
                    <div class="result-body">
                        –í–∞—à —Ñ–ª–æ—Ç –±—ã–ª —Ä–∞–∑–±–∏—Ç. –ù–∞–≥—Ä–∞–¥—ã –≤ —ç—Ç–æ—Ç —Ä–∞–∑ –Ω–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!
                    </div>
                    <div class="result-actions">
                        <button class="btn-restart" onclick="location.reload()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    </div>
                `;
            }
        }

        function determineReward() {
            const rand = Math.random() * 100; // 0..100
            const now = new Date().toLocaleString();
            const supportLink = `<a href="https://t.me/fortunawtmhelp" target="_blank" class="reward-link">—Ç–µ—Ö. –ø–æ–¥–¥–µ—Ä–∂–∫—É</a>`;

            if (rand < 15) {
                return `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Ç–∏—Ç—É–ª <b>–ê–¥–º–∏—Ä–∞–ª</b>!<br><img src="https://github.com/xF0RTUNAx/wtm-materials/blob/pics/admiral.jpg?raw=true" class="reward-img"><br>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ ${supportLink} —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º.`;
            } else if (rand < 30) {
                return `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Ç–∏—Ç—É–ª <b>–í–æ–ª—á—å—è —Å—Ç–∞—è</b>!<br><img src="https://github.com/xF0RTUNAx/wtm-materials/blob/pics/wolfpack.jpg?raw=true" class="reward-img"><br>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ ${supportLink} —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º.`;
            } else if (rand < 45) {
                return `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Ç–∏—Ç—É–ª <b>–ß–µ–º–ø–∏–æ–Ω</b>!<br><img src="https://github.com/xF0RTUNAx/wtm-materials/blob/pics/champ.jpg?raw=true" class="reward-img"><br>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ ${supportLink} —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º.`;
            } else if (rand < 99.5) {
                return "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞–≥—Ä–∞–¥–∞ —É—à–ª–∞ –ø–æ–¥ –≤–æ–¥—É –≤–º–µ—Å—Ç–µ —Å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–º.";
            } else if (rand < 99.7) { 
                return `–ù–∞–º —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–¥–æ–±—ã—Ç—å –∫–ª—é—á –Ω–∞ <b>1 –¥–µ–Ω—å –ø—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç–∞</b>. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ ${supportLink} —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º –≤—ã–∏–≥—Ä—ã—à–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–æ—á–Ω–æ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏: ${now}.`;
            } else if (rand < 99.8) { 
                return `–ù–∞–º —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–¥–æ–±—ã—Ç—å –∫–ª—é—á –Ω–∞ <b>7 –¥–Ω–µ–π –ø—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç–∞</b>. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ ${supportLink} —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º –≤—ã–∏–≥—Ä—ã—à–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–æ—á–Ω–æ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏: ${now}.`;
            } else if (rand < 99.9) { 
                return `–ù–∞–º —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–¥–æ–±—ã—Ç—å –∫–ª—é—á –Ω–∞ <b>270 –∑–æ–ª–æ—Ç–∞</b>. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ ${supportLink} —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º –≤—ã–∏–≥—Ä—ã—à–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–æ—á–Ω–æ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏: ${now}.`;
            } else { 
                return `–ù–∞–º —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–¥–æ–±—ã—Ç—å –∫–ª—é—á –Ω–∞ <b>500 –ø–ª–∞—Ç–∏–Ω–æ–≤—ã—Ö –æ—Ä–ª–æ–≤</b>. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ ${supportLink} —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º –≤—ã–∏–≥—Ä—ã—à–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–æ—á–Ω–æ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏: ${now}.`;
            }
        }

        initGrids();
    </script>
</body>
</html>
